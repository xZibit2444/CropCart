<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Meet CropCart GH partner farms across Ghana with verified quality, cold-chain readiness, and fair pricing." />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Partner Farms | CropCart GH" />
  <meta property="og:description" content="Verified farms supplying Accra and Kumasi with traceable, cold-chain produce." />
  <meta property="og:image" content="favicon-180.png" />
  <meta property="og:url" content="https://cropcartgh.com/farms" />
  <link rel="canonical" href="https://cropcartgh.com/farms" />
  <meta name="api-base" content="/api" />
  <title>Partner Farms | CropCart GH</title>
  <link rel="icon" type="image/png" sizes="32x32" href="favicon.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="favicon.png" />
  <link rel="shortcut icon" href="favicon.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="favicon.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #fafbfa;
      --fg: #1a1a1a;
      --muted: #6b7280;
      --accent: #22c55e;
      --accent-strong: #16a34a;
      --accent-light: #dcfce7;
      --card: #ffffff;
      --stroke: #e5e7eb;
      --shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
      --shadow-soft: 0 4px 16px rgba(0, 0, 0, 0.06);
      --shadow-lg: 0 20px 60px rgba(0, 0, 0, 0.12);
      --max-width: 1200px;
      --radius: 16px;
      --radius-sm: 12px;
      --header-height: 80px;
      --success: #166534;
      --error: #b91c1c;
    }

    * { box-sizing: border-box; }
    html { scroll-behavior: smooth; }
    body {
      margin: 0;
      font-family: 'Manrope', 'Segoe UI', sans-serif;
      background: var(--bg);
      color: var(--fg);
      line-height: 1.7;
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
    }

    .toast {
      position: fixed;
      right: 20px;
      bottom: 20px;
      padding: 14px 16px;
      border-radius: 12px;
      background: #0f172a;
      color: #f8fafc;
      box-shadow: 0 18px 40px rgba(0,0,0,0.16);
      opacity: 0;
      transform: translateY(16px);
      transition: opacity 0.3s ease, transform 0.3s ease;
      z-index: 140;
      pointer-events: none;
      min-width: 240px;
      font-weight: 700;
    }

    .toast.show { opacity: 1; transform: translateY(0); }
    .toast.error { background: #991b1b; }
    .toast.success { background: #166534; }

    .field-error {
      display: none;
      color: var(--error);
      font-size: 13px;
      margin-top: 6px;
      font-weight: 600;
    }

    .input-error {
      border-color: #f87171 !important;
      background: #fff7f7;
    }

    header {
      position: sticky;
      top: 0;
      z-index: 100;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--stroke);
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
      overflow: hidden;
    }

    nav {
      width: 100%;
      max-width: none;
      margin: 0;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 24px;
      height: 200px;
      gap: 16px;
    }

    .brand {
      display: flex;
      align-items: center;
      height: 200px;
      text-decoration: none;
      flex-shrink: 1;
      min-width: 0;
    }
    .brand:hover { opacity: 0.9; }
    .brand-mark {
      width: 1100px;
      height: 200px;
      max-width: 100%;
      display: block;
      object-fit: contain;
      object-position: left;
    }

    .nav-links {
      display: flex;
      align-items: center;
      gap: 16px;
      flex-shrink: 0;
    }

    .nav-links a {
      position: relative;
      font-weight: 600;
      font-size: 14px;
      color: var(--muted);
      text-decoration: none;
      padding: 6px 0;
      transition: color 0.2s ease;
      white-space: nowrap;
    }

    .nav-links a::after {
      content: "";
      position: absolute;
      left: 0;
      bottom: 0;
      width: 100%;
      height: 2px;
      background: var(--accent);
      transform: scaleX(0);
      transform-origin: left;
      transition: transform 0.2s ease;
    }

    .nav-links a:hover { color: var(--fg); }
    .nav-links a:hover::after, .nav-links a[aria-current="page"]::after { transform: scaleX(1); }
    .nav-links a[aria-current="page"] { color: var(--fg); }

    .cta-btn {
      padding: 12px 24px;
      border-radius: var(--radius-sm);
      border: none;
      background: var(--accent);
      color: white;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: var(--shadow-soft);
      font-size: 15px;
    }
    .cta-btn:hover { background: var(--accent-strong); transform: translateY(-2px); box-shadow: var(--shadow); }

    @keyframes spin { to { transform: rotate(360deg); } }

    main {
      max-width: var(--max-width);
      margin: 0 auto;
      padding: 40px 32px 100px;
    }

    .page-header {
      padding: 60px 0 40px;
      text-align: center;
    }

    .page-header h1 {
      font-size: clamp(36px, 5vw, 52px);
      margin: 0 0 16px;
      font-weight: 800;
      letter-spacing: -0.02em;
    }

    .page-header p {
      color: var(--muted);
      font-size: 18px;
      max-width: 680px;
      margin: 0 auto;
    }

    .filters {
      display: flex;
      gap: 12px;
      justify-content: center;
      margin: 32px 0;
      flex-wrap: wrap;
      align-items: center;
    }

    .filter-bar {
      width: 100%;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 12px;
      align-items: center;
      margin-bottom: 12px;
    }

    .search-input, .select-filter {
      padding: 12px 14px;
      border: 2px solid var(--stroke);
      border-radius: var(--radius-sm);
      font-size: 14px;
      background: var(--card);
      width: 100%;
    }

    .filter-btn {
      padding: 10px 20px;
      border-radius: 999px;
      border: 2px solid var(--stroke);
      background: var(--card);
      color: var(--fg);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 14px;
    }

    .filter-buttons {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .filter-btn:hover {
      border-color: var(--accent);
      background: var(--accent-light);
    }

    .filter-btn.active {
      border-color: var(--accent);
      background: var(--accent);
      color: white;
    }

    .farms-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
      gap: 24px;
      margin-top: 40px;
    }

    .farm-card {
      background: var(--card);
      border: 2px solid var(--stroke);
      border-radius: var(--radius);
      padding: 28px;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .farm-card::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      height: 100%;
      width: 5px;
      background: var(--accent);
      transform: scaleY(0);
      transform-origin: bottom;
      transition: transform 0.3s ease;
    }

    .farm-card:hover {
      border-color: var(--accent-light);
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg);
    }

    .farm-card:hover::before {
      transform: scaleY(1);
    }

    .farm-header {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      margin-bottom: 16px;
    }

    .farm-icon {
      width: 48px;
      height: 48px;
      background: var(--accent-light);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .farm-icon svg {
      width: 28px;
      height: 28px;
      fill: var(--accent);
    }

    .farm-title {
      flex: 1;
    }

    .farm-title h3 {
      margin: 0 0 4px;
      font-size: 20px;
      font-weight: 700;
      color: var(--fg);
    }

    .farm-location {
      display: flex;
      align-items: center;
      gap: 6px;
      color: var(--muted);
      font-size: 14px;
      font-weight: 500;
    }

    .farm-location svg {
      width: 14px;
      height: 14px;
      fill: var(--accent);
    }

    .farm-specialties {
      margin: 16px 0;
    }

    .farm-specialties h4 {
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--muted);
      margin: 0 0 8px;
      font-weight: 700;
    }

    .specialties-list {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .specialty-tag {
      padding: 4px 10px;
      background: var(--accent-light);
      color: var(--accent-strong);
      border-radius: 999px;
      font-size: 13px;
      font-weight: 600;
    }

    .farm-certifications {
      display: flex;
      gap: 8px;
      margin: 16px 0;
      flex-wrap: wrap;
    }

    .cert-badge {
      padding: 6px 12px;
      background: linear-gradient(135deg, #ffffff 0%, #f9fafb 100%);
      border: 1px solid var(--stroke);
      border-radius: 8px;
      font-size: 12px;
      font-weight: 600;
      color: var(--fg);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .cert-badge::before {
      content: '✓';
      width: 16px;
      height: 16px;
      background: var(--accent);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      font-weight: 700;
    }

    .farm-features {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin: 16px 0;
    }

    .feature-pill {
      padding: 6px 12px;
      background: var(--bg);
      border-radius: 999px;
      font-size: 12px;
      color: var(--muted);
      font-weight: 500;
    }

    .farm-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid var(--stroke);
    }

    .capacity {
      font-size: 14px;
      font-weight: 600;
      color: var(--accent-strong);
    }

    .established {
      font-size: 13px;
      color: var(--muted);
    }

    .contact-btn {
      margin-top: 16px;
      width: 100%;
      padding: 12px;
      border-radius: var(--radius-sm);
      border: 2px solid var(--stroke);
      background: var(--card);
      color: var(--fg);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 15px;
    }

    .contact-btn:hover {
      border-color: var(--accent);
      background: var(--accent-light);
      transform: translateY(-2px);
    }

    .loading {
      text-align: center;
      padding: 60px 20px;
      color: var(--muted);
      font-size: 18px;
    }

    .error {
      text-align: center;
      padding: 60px 20px;
      color: #dc2626;
      font-size: 16px;
    }

    .stats-bar {
      display: flex;
      gap: 32px;
      justify-content: center;
      padding: 24px;
      background: var(--card);
      border-radius: var(--radius);
      border: 2px solid var(--stroke);
      margin: 32px 0;
    }

    .stat-item {
      text-align: center;
    }

    .stat-item strong {
      display: block;
      font-size: 32px;
      font-weight: 800;
      color: var(--accent);
      margin-bottom: 4px;
    }

    .stat-item span {
      color: var(--muted);
      font-size: 14px;
      font-weight: 500;
    }

    @media (max-width: 900px) {
      nav { flex-wrap: wrap; gap: 12px; padding: 0 16px; }
      .nav-links { flex-wrap: wrap; justify-content: flex-start; gap: 8px; }
      .nav-links a { padding: 6px 4px; font-size: 14px; }
      .cta-btn { padding: 10px 16px; font-size: 14px; }
      .farms-grid { grid-template-columns: 1fr; }
      .stats-bar { flex-direction: column; gap: 16px; }
    }

    @media (max-width: 620px) {
      nav { padding: 8px 16px; height: auto; min-height: 60px; }
      main { padding: 40px 16px 80px; }
      .brand { height: 36px; }
      .brand-mark { height: 100%; width: auto; }
      .nav-links { width: 100%; flex-wrap: wrap; justify-content: center; gap: 8px; margin-top: 8px; }
      .nav-links a { font-size: 13px; padding: 4px 6px; }
      .cta-btn { padding: 10px 14px; font-size: 13px; min-height: 44px; }
      h1 { font-size: 28px !important; }
      .stats-bar { padding: 0 16px; }
    }

    /* Become a Partner Section */
    .partner-cta {
      margin: 80px 0 40px;
      padding: 60px 48px;
      background: linear-gradient(135deg, #16a34a 0%, #22c55e 100%);
      border-radius: var(--radius);
      text-align: center;
      color: white;
      box-shadow: var(--shadow-lg);
    }

    .partner-cta h2 {
      font-size: 36px;
      font-weight: 800;
      margin: 0 0 16px;
      color: white;
    }

    .partner-cta p {
      font-size: 18px;
      opacity: 0.95;
      margin: 0 auto 32px;
      max-width: 600px;
      line-height: 1.6;
    }

    .partner-benefits {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 24px;
      margin: 32px 0;
      text-align: left;
    }

    .benefit-item {
      display: flex;
      gap: 12px;
      align-items: flex-start;
    }

    .benefit-item svg {
      width: 24px;
      height: 24px;
      fill: white;
      flex-shrink: 0;
      opacity: 0.9;
    }

    .benefit-item div h4 {
      margin: 0 0 4px;
      font-size: 16px;
      font-weight: 700;
      color: white;
    }

    .benefit-item div p {
      margin: 0;
      font-size: 14px;
      opacity: 0.85;
      line-height: 1.5;
    }

    .apply-btn {
      padding: 16px 48px;
      background: white;
      color: var(--accent-strong);
      border: none;
      border-radius: var(--radius-sm);
      font-size: 16px;
      font-weight: 700;
      font-family: 'Manrope', sans-serif;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .apply-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
    }

    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(4px);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: white;
      border-radius: var(--radius);
      max-width: 600px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: var(--shadow-lg);
      animation: slideUp 0.3s ease;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .modal-header {
      padding: 32px 32px 24px;
      border-bottom: 1px solid var(--stroke);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-header h3 {
      margin: 0;
      font-size: 24px;
      font-weight: 800;
      color: var(--fg);
    }

    .close-modal {
      background: none;
      border: none;
      font-size: 28px;
      color: var(--muted);
      cursor: pointer;
      padding: 0;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      transition: all 0.2s ease;
    }

    .close-modal:hover {
      background: var(--bg);
      color: var(--fg);
    }

    .modal-body {
      padding: 32px;
    }

    .form-group {
      margin-bottom: 24px;
    }

    .form-group label {
      display: block;
      font-weight: 600;
      margin-bottom: 8px;
      color: var(--fg);
      font-size: 14px;
    }

    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid var(--stroke);
      border-radius: var(--radius-sm);
      font-family: 'Manrope', sans-serif;
      font-size: 15px;
      color: var(--fg);
      transition: border-color 0.2s ease;
    }

    .form-group input:focus,
    .form-group textarea:focus,
    .form-group select:focus {
      outline: none;
      border-color: var(--accent);
    }

    .form-group textarea {
      resize: vertical;
      min-height: 100px;
    }

    .form-group small {
      display: block;
      margin-top: 6px;
      color: var(--muted);
      font-size: 13px;
    }

    .submit-btn {
      width: 100%;
      padding: 16px;
      background: linear-gradient(135deg, #16a34a, #22c55e);
      color: white;
      border: none;
      border-radius: var(--radius-sm);
      font-size: 16px;
      font-weight: 700;
      font-family: 'Manrope', sans-serif;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .submit-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 20px rgba(34, 197, 94, 0.3);
    }

    .submit-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    @media (max-width: 620px) {
      .partner-cta {
        padding: 40px 24px;
      }
      .partner-cta h2 {
        font-size: 28px;
      }
      .partner-benefits {
        grid-template-columns: 1fr;
      }
      .modal-content {
        margin: 0;
      }
      .modal-header,
      .modal-body {
        padding: 24px;
      }
    }
  </style>
</head>
<body>
  <header>
    <nav>
      <a href="index.html" class="brand" aria-label="CropCart GH">
        <img class="brand-mark" src="logo.png" alt="CropCart GH" />
      </a>
      <div class="nav-links">
        <a href="how-it-works.html">How it works</a>
        <a href="farms.html" aria-current="page">Partner farms</a>
        <a href="faq.html">FAQ</a>
        <a href="waitlist.html">Waitlist</a>
        <a href="blog.html">Blog</a>
        <button class="cta-btn" onclick="window.location.href='waitlist.html'">Join waitlist</button>
      </div>
    </nav>
  </header>

  <main>
    <div class="page-header">
      <h1>Our Partner Farms</h1>
      <p>Verified growers across Ghana committed to quality, sustainability, and fair pricing. Each farm is audited quarterly and tracked for cold-chain compliance.</p>
    </div>

    <div class="stats-bar" id="stats-bar">
      <div class="stat-item">
        <strong id="total-farms">—</strong>
        <span>Partner Farms</span>
      </div>
      <div class="stat-item">
        <strong id="total-regions">—</strong>
        <span>Regions</span>
      </div>
      <div class="stat-item">
        <strong id="total-capacity">—</strong>
        <span>Weekly Capacity</span>
      </div>
    </div>

    <div class="filters" id="filters"></div>

    <div class="farms-grid" id="farms-grid">
      <div class="loading">Loading farms...</div>
    </div>



    <!-- Become a Partner Section -->
    <div class="partner-cta">
      <h2>Become a Partner Farm</h2>
      <p>Join our network of verified farms supplying fresh produce across Ghana. Get access to wholesale buyers and premium pricing.</p>
      
      <div class="partner-benefits">
        <div class="benefit-item">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
          <div>
            <h4>Fair Pricing</h4>
            <p>Market-leading rates with transparent pricing</p>
          </div>
        </div>
        <div class="benefit-item">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 2C12 2 6 8 6 14C6 17.31 8.69 20 12 20C15.31 20 18 17.31 18 14C18 8 12 2 12 2Z"/>
          </svg>
          <div>
            <h4>Direct Access</h4>
            <p>Connect with wholesale buyers instantly</p>
          </div>
        </div>
        <div class="benefit-item">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3"/>
          </svg>
          <div>
            <h4>Free Support</h4>
            <p>Training on cold-chain and quality standards</p>
          </div>
        </div>
      </div>

      <button class="apply-btn" onclick="openApplicationModal()">Apply Now</button>
    </div>
  </main>

  <!-- Application Modal -->
  <div class="modal" id="application-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Partner Farm Application</h3>
        <button class="close-modal" onclick="closeApplicationModal()">&times;</button>
      </div>
      <div class="modal-body">
        <form id="application-form" onsubmit="submitApplication(event)">
          <div class="form-group">
            <label for="farm-name">Farm Name *</label>
            <input type="text" id="farm-name" name="farmName" required placeholder="e.g., Green Valley Farms">
            <div class="field-error" data-error-for="farm-name"></div>
          </div>

          <div class="form-group">
            <label for="location">Location *</label>
            <input type="text" id="location" name="location" required placeholder="e.g., Accra, Greater Accra Region">
            <div class="field-error" data-error-for="location"></div>
          </div>

          <div class="form-group">
            <label for="farm-size">Farm Size (acres) *</label>
            <input type="number" id="farm-size" name="farmSize" required placeholder="e.g., 50">
            <div class="field-error" data-error-for="farm-size"></div>
          </div>

          <div class="form-group">
            <label for="specialties">Main Crops/Specialties *</label>
            <textarea id="specialties" name="specialties" required placeholder="e.g., Tomatoes, Peppers, Leafy Greens"></textarea>
            <small>List the main produce you grow</small>
            <div class="field-error" data-error-for="specialties"></div>
          </div>

          <div class="form-group">
            <label for="certifications">Certifications (if any)</label>
            <input type="text" id="certifications" name="certifications" placeholder="e.g., Organic, GlobalGAP">
          </div>

          <div class="form-group">
            <label for="contact-name">Contact Person Name *</label>
            <input type="text" id="contact-name" name="contactName" required placeholder="Full name">
            <div class="field-error" data-error-for="contact-name"></div>
          </div>

          <div class="form-group">
            <label for="phone">Phone Number *</label>
            <input type="tel" id="phone" name="phone" required placeholder="e.g., +233 XX XXX XXXX">
            <div class="field-error" data-error-for="phone"></div>
          </div>

          <div class="form-group">
            <label for="email">Email Address *</label>
            <input type="email" id="email" name="email" required placeholder="your@email.com">
            <div class="field-error" data-error-for="email"></div>
          </div>

          <div class="form-group">
            <label for="experience">Years of Farming Experience *</label>
            <select id="experience" name="experience" required>
              <option value="">Select...</option>
              <option value="0-2">0-2 years</option>
              <option value="3-5">3-5 years</option>
              <option value="6-10">6-10 years</option>
              <option value="10+">10+ years</option>
            </select>
            <div class="field-error" data-error-for="experience"></div>
          </div>

          <div class="form-group">
            <label for="message">Additional Information</label>
            <textarea id="message" name="message" placeholder="Tell us more about your farm and why you'd like to partner with CropCart GH"></textarea>
          </div>

          <button type="submit" class="submit-btn">Submit Application</button>
        </form>
      </div>
    </div>
  </div>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  <script type="module">
    // Supabase client - import from CDN
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';
    const SUPABASE_URL = 'https://djuvkrjotiowrngcjqrm.supabase.co';
    const SUPABASE_KEY = 'sb_publishable_IAdc3pEESUgbCt_sKAE5nQ_9zLGO3Kg';
    const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

    // API helper for farms
    const api = {
      getFarms: async () => {
        const { data, error } = await supabase
          .from('farms')
          .select('*')
          .order('created_at', { ascending: false });
        return { data, error };
      }
    };

    const API_BASE = (document.querySelector('meta[name="api-base"]')?.content || window.API_BASE || 'http://localhost:3001');
    window.API_BASE = API_BASE;
    let allFarms = [];
    let activeLocation = 'all';
    let activeSpecialty = 'all';
    let searchTerm = '';
    const toastEl = document.getElementById('toast');
    const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

    const showToast = (message, type = 'success') => {
      if (!toastEl) return;
      toastEl.textContent = message;
      toastEl.className = `toast ${type}`;
      requestAnimationFrame(() => {
        toastEl.classList.add('show');
        setTimeout(() => toastEl.classList.remove('show'), 3200);
      });
    };

    const clearFieldErrors = (formEl) => {
      formEl.querySelectorAll('.field-error').forEach(el => { el.textContent = ''; el.style.display = 'none'; });
      formEl.querySelectorAll('.input-error').forEach(el => el.classList.remove('input-error'));
    };

    const setFieldError = (formEl, id, message) => {
      const input = formEl.querySelector(`#${id}`);
      const errorEl = formEl.querySelector(`.field-error[data-error-for="${id}"]`);
      if (message) {
        input?.classList.add('input-error');
        if (errorEl) { errorEl.textContent = message; errorEl.style.display = 'block'; }
      } else {
        input?.classList.remove('input-error');
        if (errorEl) { errorEl.textContent = ''; errorEl.style.display = 'none'; }
      }
    };

    async function loadFarms() {
      try {
        console.log('Starting to load farms...');
        console.log('API object:', api);
        
        // Fetch farms from Supabase
        const { data, error } = await api.getFarms();
        
        console.log('Supabase response:', { data, error });
        
        if (error) {
          throw error;
        }

        if (!data || data.length === 0) {
          document.getElementById('farms-grid').innerHTML = `
            <div class="loading">No farms available yet. Please run the setup SQL in Supabase.</div>
          `;
          return;
        }

        console.log('Loaded farms from Supabase:', data);
        allFarms = data;
        
        updateStats();
        createFilters();
        applyFilters();
      } catch (error) {
        console.error('Error loading farms:', error);
        document.getElementById('farms-grid').innerHTML = `
          <div class="error">
            Unable to load farms: ${error.message}
          </div>
        `;
      }
    }

    function generateMockFarms() {
      const farmNames = [
        'Green Valley Farms', 'Sunrise Agriculture', 'Fertile Fields Co', 'Harvest Haven', 'Golden Produce Growers',
        'Community Gardens Accra', 'Fresh Roots Farm', 'Sustainable Growth', 'Urban Harvest', 'Heritage Farms Ghana'
      ];
      const locations = ['Accra', 'Kumasi', 'Tema', 'Cape Coast', 'Takoradi', 'Greater Accra Region'];
      const crops = [
        'Tomatoes', 'Peppers', 'Leafy Greens', 'Cucumber', 'Carrots', 'Lettuce', 'Spinach', 'Kale',
        'Eggplant', 'Okra', 'Maize', 'Cassava', 'Yam', 'Plantain'
      ];
      const certifications = ['Organic', 'GlobalGAP', 'Fair Trade', 'ISO 9001'];
      const features = ['Cold Storage', 'GPS Tracking', 'Eco-Friendly', 'Certified Organic', 'Direct to Consumer'];

      const farms = [];
      for (let i = 0; i < 12; i++) {
        const farmSpecialties = [];
        for (let j = 0; j < Math.floor(Math.random() * 3) + 2; j++) {
          const crop = crops[Math.floor(Math.random() * crops.length)];
          if (!farmSpecialties.includes(crop)) farmSpecialties.push(crop);
        }

        const farmCertifications = [];
        for (let j = 0; j < Math.floor(Math.random() * 2) + 1; j++) {
          const cert = certifications[Math.floor(Math.random() * certifications.length)];
          if (!farmCertifications.includes(cert)) farmCertifications.push(cert);
        }

        const farmFeatures = [];
        for (let j = 0; j < Math.floor(Math.random() * 2) + 1; j++) {
          const feature = features[Math.floor(Math.random() * features.length)];
          if (!farmFeatures.includes(feature)) farmFeatures.push(feature);
        }

        farms.push({
          id: `farm-${i + 1}`,
          name: farmNames[i % farmNames.length],
          location: locations[Math.floor(Math.random() * locations.length)],
          specialties: farmSpecialties,
          certifications: farmCertifications,
          features: farmFeatures,
          capacity: `${20 + Math.floor(Math.random() * 80)} cases/week`,
          established: 2015 + Math.floor(Math.random() * 8),
          contact: {
            phone: `+233 ${String(Math.floor(Math.random() * 9000000000)).padStart(10, '0')}`,
            email: `info@${farmNames[i % farmNames.length].toLowerCase().replace(/\s+/g, '')}.com`
          }
        });
      }
      return farms;
    }

    function updateStats() {
      const regions = new Set(allFarms.map(f => f.location)).size;
      const totalCapacity = allFarms.length * 60; // Approximate
      
      document.getElementById('total-farms').textContent = allFarms.length;
      document.getElementById('total-regions').textContent = regions;
      document.getElementById('total-capacity').textContent = `${totalCapacity}+ cases`;
    }

    function createFilters() {
      const locations = Array.from(new Set(allFarms.map(f => f.location)));
      const specialties = Array.from(new Set(allFarms.flatMap(f => f.specialties || [])));

      const filtersHTML = `
        <div class="filter-bar">
          <input id="farm-search" class="search-input" type="search" placeholder="Search by farm, crop, or certification" />
          <select id="specialty-filter" class="select-filter">
            <option value="all">All specialties</option>
            ${specialties.map(s => `<option value="${s}">${s}</option>`).join('')}
          </select>
          <select id="location-filter" class="select-filter">
            <option value="all">All locations</option>
            ${locations.map(loc => `<option value="${loc}">${loc}</option>`).join('')}
          </select>
        </div>
        <div class="filter-buttons">
          <button class="filter-btn active" data-location="all">All Locations</button>
          ${locations.map(loc => `<button class="filter-btn" data-location="${loc}">${loc}</button>`).join('')}
        </div>
      `;

      document.getElementById('filters').innerHTML = filtersHTML;

      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          activeLocation = btn.dataset.location;
          applyFilters();
        });
      });

      document.getElementById('location-filter').addEventListener('change', (e) => {
        activeLocation = e.target.value;
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        const match = Array.from(document.querySelectorAll('.filter-btn')).find(b => b.dataset.location === activeLocation);
        if (match) match.classList.add('active');
        applyFilters();
      });

      document.getElementById('specialty-filter').addEventListener('change', (e) => {
        activeSpecialty = e.target.value;
        applyFilters();
      });

      document.getElementById('farm-search').addEventListener('input', (e) => {
        searchTerm = e.target.value.toLowerCase();
        applyFilters();
      });
    }

    function applyFilters() {
      let filtered = [...allFarms];

      if (activeLocation !== 'all') {
        filtered = filtered.filter(f => f.location === activeLocation);
      }

      if (activeSpecialty !== 'all') {
        filtered = filtered.filter(f => (f.specialties || []).includes(activeSpecialty));
      }

      if (searchTerm) {
        filtered = filtered.filter(f => {
          const haystack = [f.name, f.location, ...(f.specialties || []), ...(f.certifications || []), ...(f.features || [])]
            .join(' ')?.toLowerCase() || '';
          return haystack.includes(searchTerm);
        });
      }

      renderFarms(filtered);
    }

    function renderFarms(farms) {
      if (farms.length === 0) {
        document.getElementById('farms-grid').innerHTML = `
          <div class="loading">No farms found in this location.</div>
        `;
        return;
      }

      const farmsHTML = farms.map(farm => `
        <div class="farm-card">
          <div class="farm-header">
            <div class="farm-icon">
              <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2C12 2 6 8 6 14C6 17.31 8.69 20 12 20C15.31 20 18 17.31 18 14C18 8 12 2 12 2Z"/>
              </svg>
            </div>
            <div class="farm-title">
              <h3>${farm.name}</h3>
              <div class="farm-location">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                </svg>
                ${farm.location}
              </div>
            </div>
          </div>

          <div class="farm-specialties">
            <h4>Specialties</h4>
            <div class="specialties-list">
              ${farm.specialties.map(s => `<span class="specialty-tag">${s}</span>`).join('')}
            </div>
          </div>

          <div class="farm-certifications">
            ${farm.certifications.map(c => `<span class="cert-badge">${c}</span>`).join('')}
          </div>

          <div class="farm-features">
            ${farm.features.map(f => `<span class="feature-pill">${f}</span>`).join('')}
          </div>

          <div class="farm-meta">
            <span class="capacity">${farm.capacity}</span>
            <span class="established">Est. ${farm.established}</span>
          </div>
          <div style="display:flex; gap:8px; margin-top:10px;">
            <span class="feature-pill">Availability: Contact for season</span>
            <span class="feature-pill">Dispatch: Mon/Wed/Fri</span>
          </div>

          <button class="contact-btn" onclick="contactFarm('${farm.id}', '${farm.name}')">
            Contact Farm
          </button>
        </div>
      `).join('');

      document.getElementById('farms-grid').innerHTML = farmsHTML;
    }

    function contactFarm(id, name) {
      const farm = allFarms.find(f => f.id === id);
      if (farm && farm.contact) {
        showToast(`Contact ${name}: ${farm.contact.phone} · ${farm.contact.email}`, 'success');
      } else {
        showToast('Contact details not available yet.', 'error');
      }
    }

    // Load farms on page load
    loadFarms();
    // Location hint
    function updateDispatchText() {
      const area = (localStorage.getItem('cc_area') || '').trim();
      const el = document.getElementById('dispatch-text');
      if (!el) return;
      if (area) {
        el.textContent = `We deliver to ${area} on Mon/Wed/Fri; cut-off 5pm prior day.`;
      } else {
        el.textContent = 'We deliver Mon/Wed/Fri in Greater Accra';
      }
    }
    updateDispatchText();
    const areaInput = document.getElementById('user-area');
    areaInput?.addEventListener('input', (e) => {
      const val = e.target.value || '';
      localStorage.setItem('cc_area', val);
      updateDispatchText();
    });

    // Mobile sticky filter button behavior
    function setStickyVisibility() {
      const sticky = document.getElementById('mobile-sticky');
      if (!sticky) return;
      sticky.style.display = (window.innerWidth <= 620) ? 'block' : 'none';
    }
    setStickyVisibility();
    window.addEventListener('resize', setStickyVisibility);
    document.getElementById('open-filters')?.addEventListener('click', () => {
      const el = document.getElementById('filters');
      if (el) {
        el.scrollIntoView({ behavior: 'smooth', block: 'start' });
        el.style.boxShadow = '0 10px 30px rgba(0,0,0,0.12)';
        setTimeout(() => { el.style.boxShadow = ''; }, 900);
      }
    });

    // Header shadow on scroll
    const headerEl = document.querySelector('header');
    let lastScrollY = 0;
    window.addEventListener('scroll', () => {
      const y = window.scrollY || document.documentElement.scrollTop;
      if (!headerEl) return;
      if (y > 8 && lastScrollY <= 8) {
        headerEl.style.boxShadow = '0 8px 24px rgba(0,0,0,0.06)';
      } else if (y <= 8 && lastScrollY > 8) {
        headerEl.style.boxShadow = '0 2px 8px rgba(0,0,0,0.04)';
      }
      lastScrollY = y;
    });

    // Modal functions
    function openApplicationModal() {
      document.getElementById('application-modal').classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function closeApplicationModal() {
      document.getElementById('application-modal').classList.remove('active');
      document.body.style.overflow = '';
      document.getElementById('application-form').reset();
    }

    // Close modal on backdrop click
    document.getElementById('application-modal').addEventListener('click', (e) => {
      if (e.target.id === 'application-modal') {
        closeApplicationModal();
      }
    });

    // Close modal on Escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closeApplicationModal();
      }
    });

    // Handle form submission
    async function submitApplication(event) {
      event.preventDefault();
      const formEl = event.target;
      clearFieldErrors(formEl);
      const formData = new FormData(formEl);
      const applicationData = Object.fromEntries(formData.entries());
      const submitBtn = formEl.querySelector('.submit-btn');

      let hasError = false;
      const requiredIds = ['farm-name', 'location', 'farm-size', 'specialties', 'contact-name', 'phone', 'email', 'experience'];
      requiredIds.forEach(id => {
        if (!formEl.querySelector(`#${id}`)?.value.trim()) {
          setFieldError(formEl, id, 'This field is required.');
          hasError = true;
        }
      });

      if (applicationData.email && !emailPattern.test(applicationData.email)) {
        setFieldError(formEl, 'email', 'Use a valid email.');
        hasError = true;
      }

      if (hasError) {
        showToast('Fix the highlighted fields to submit.', 'error');
        return;
      }

      submitBtn.disabled = true;
      submitBtn.innerHTML = '<span style="width:16px;height:16px;border:2px solid rgba(255,255,255,0.6);border-top-color:#fff;border-radius:50%;display:inline-block;margin-right:8px;vertical-align:middle;animation:spin 0.8s linear infinite;"></span>Submitting...';

      try {
        await new Promise((resolve) => setTimeout(resolve, 300));
        
        const { data, error } = await supabase
          .from('farm_applications')
          .insert([{
            name: applicationData.contactName,
            email: applicationData.email,
            farm_name: applicationData.farmName,
            location: applicationData.location,
            products: applicationData.specialties
          }])
          .select();

        if (error) throw error;

        showToast(`Application received for ${applicationData.farmName}. We'll reply to ${applicationData.email}.`, 'success');
        closeApplicationModal();
      } catch (error) {
        console.error('Error submitting application:', error);
        showToast('Failed to submit application. Please try again.', 'error');
        submitBtn.disabled = false;
        submitBtn.textContent = 'Submit Application';
      }
    }
  </script>
</body>
</html>
